(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-046a2bc6"],{"245c":function(e,t,r){},"395d":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"page review"},[r("div",{staticClass:"page-header bg-white"},[r("div",[r("h2",{staticClass:"page-header__breadcrumbs"},[e._v("Internal Review")]),r("h2",{staticClass:"page-header__title"},[r("b",[e._v(e._s(e.review?e.review.name:""))])])]),r("div",{staticClass:"page-header__actions"},[r("div",[r("button",{staticClass:"btn btn-default mr-3",on:{click:e.download_pdf}},[e._v("Download")]),r("button",{staticClass:"btn btn-dark mr-3",on:{click:function(t){return e.saveGeneral(!0)}}},[e._v("Save and Exit")]),r("button",{staticClass:"btn btn__close",on:{click:e.backToList}},[r("b-icon",{attrs:{icon:"x"}})],1)])])]),r("b-tabs",{staticClass:"reviews__tabs",attrs:{"content-class":"mt-0"},scopedSlots:e._u([{key:"tabs-end",fn:function(){return[r("b-dropdown",{staticClass:"actions",attrs:{text:"Actions",variant:"default",right:""},scopedSlots:e._u([{key:"button-content",fn:function(){return[e._v("Actions"),r("b-icon",{staticClass:"m-l-1",attrs:{icon:"chevron-down","font-scale":"1"}})]},proxy:!0}])},[r("AnnualModalEdit",{attrs:{review:e.review||{},inline:!1}},[r("b-dropdown-item",[e._v("Edit")])],1),r("AnnualModalDelete",{attrs:{inline:!1},on:{deleteConfirmed:function(t){return e.deleteReview(e.review.id)}}},[r("b-dropdown-item",{staticClass:"delete"},[e._v("Delete")])],1)],1)]},proxy:!0}])},[r("b-tab",{attrs:{title:"Detail",active:""}},[e.review?r("div",{staticClass:"p-x-40"},[r("div",{staticClass:"row"},[r("div",{staticClass:"col-md-3"},[r("ReviewsList",{attrs:{"annual-id":e.annualId,"reviews-categories":e.review.review_categories,general:!0,generalComplete:e.review.complete}})],1),r("div",{staticClass:"col-md-9 m-b-40"},[r("div",{staticClass:"card-body white-card-body reviews__card"},[r("div",{staticClass:"reviews__card--internal pt-0"},[r("h3",[e._v("General")])]),r("div",{staticClass:"reviews__card--internal"},[r("div",{staticClass:"row"},[r("div",{staticClass:"col-md-12"},[r("h4",[r("b",[e._v("Review Period")])])])]),r("div",{staticClass:"row"},[r("div",{staticClass:"col-6"},[r("label",{staticClass:"form-label"},[e._v("Start Date")]),r("b-form-datepicker",{attrs:{"date-format-options":{year:"numeric",month:"2-digit",day:"2-digit"},locale:"en-US"},model:{value:e.review.review_start,callback:function(t){e.$set(e.review,"review_start",t)},expression:"review.review_start"}}),r("Errors",{attrs:{errors:e.errors.review_start}})],1),r("div",{staticClass:"col-6"},[r("label",{staticClass:"form-label"},[e._v("End Date"),r("b-form-datepicker",{attrs:{"date-format-options":{year:"numeric",month:"2-digit",day:"2-digit"},locale:"en-US"},model:{value:e.review.review_end,callback:function(t){e.$set(e.review,"review_end",t)},expression:"review.review_end"}})],1),r("Errors",{attrs:{errors:e.errors.review_end}})],1)])]),r("div",{staticClass:"reviews__card--internal"},[r("div",{staticClass:"row"},[r("div",{staticClass:"col-md-12"},[r("h4",[r("b",[e._v("Material Business Changes")])]),r("p",[e._v("List any changes to your business processes, key vendors, and/or key employees during the Review Period")])]),r("div",{staticClass:"col-12"},[r("Tiptap",{model:{value:e.review.material_business_changes,callback:function(t){e.$set(e.review,"material_business_changes",t)},expression:"review.material_business_changes"}}),e.errors.material_business_changes?r("div",{staticClass:"invalid-feedback d-block"},[e._v(e._s(e.errors.material_business_changes))]):e._e()],1)])]),r("div",{staticClass:"reviews__card--internal"},[r("div",{staticClass:"row"},[r("div",{staticClass:"col-md-12"},[r("h4",[r("b",[e._v("Material Regulatory Changes")])]),r("p",[e._v("List any regulatory changes that impacted you during the Review Period and how the business responded.")])])]),e._l(e.regulatoryChangesSplit,(function(t,a){return r("div",{key:a,staticClass:"row mb-3"},[r("div",{staticClass:"custom-col"},[r("label",{staticClass:"form-label"},[e._v("Change")]),r("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t[0].change,expression:"regulatory[0].change",modifiers:{trim:!0}}],staticClass:"form-control",attrs:{placeholder:"Describe the change"},domProps:{value:t[0].change},on:{input:function(r){r.target.composing||e.$set(t[0],"change",r.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),e.errors.regulatory&&e.errors.regulatory[a]&&e.errors.regulatory[a][0]?r("Errors",{attrs:{errors:e.errors.regulatory[a][0]}}):e._e()],1),r("div",{staticClass:"custom-col"},[r("label",{staticClass:"form-label"},[e._v("Response")]),r("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t[1].change,expression:"regulatory[1].change",modifiers:{trim:!0}}],staticClass:"form-control",attrs:{placeholder:"Describe the response"},domProps:{value:t[1].change},on:{input:function(r){r.target.composing||e.$set(t[1],"change",r.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),e.errors.regulatory&&e.errors.regulatory[a]&&e.errors.regulatory[a][1]?r("Errors",{attrs:{errors:e.errors.regulatory[a][1]}}):e._e()],1),r("div",{staticClass:"delete-col"},[e.regulatoryChangesSplit.length>1?r("button",{staticClass:"btn btn__close float-right remove-regulatory",on:{click:function(r){return e.removeRegulatoryChange(t,a)}}},[r("b-icon",{attrs:{icon:"x","font-scale":"1"}})],1):e._e()])])})),r("div",{staticClass:"mt-3"},[r("button",{staticClass:"btn btn-default",on:{click:e.addRegulatoryChange}},[r("b-icon",{staticClass:"mr-2",attrs:{icon:"plus-circle-fill"}}),e._v("New Entry")],1)])],2),r("div",{staticClass:"reviews__card--internal"},[r("div",{staticClass:"row"},[r("div",{staticClass:"col-md-12"},[r("h4",[r("b",[e._v("Key Employees Interviewed")])]),r("p",[e._v("Regulators interview employees to uncover potential discrepancies in a firm's policies and procedures and their day-to-day practicies. It's important to interview those employees responsible for certain key tasks or have access to sensitive client in order to hear about their day-to-day activities in their own words.")])])]),r("div",{staticClass:"row"},[r("div",{staticClass:"col-md-12"},[r("b-form",[e.review.annual_review_employees&&e.review.annual_review_employees.length?r("div",{staticClass:"row"},[r("div",{staticClass:"col-4"},[r("label",[e._v("Employee Name")])]),r("div",{staticClass:"col-4 px-0"},[r("label",[e._v("Title/Role")])]),r("div",{staticClass:"col-4"},[r("label",[e._v("Department")])])]):e._e(),e._l(e.employees,(function(t,a){return[r("div",{key:""+a,staticClass:"row"},[r("div",{staticClass:"col-4"},[r("b-input-group",{staticClass:"m-b-1"},[r("b-form-input",{staticClass:"mb-2 mr-sm-2 mb-sm-0",attrs:{placeholder:"Enter Name"},model:{value:t.name,callback:function(r){e.$set(t,"name",r)},expression:"annualReviewEmployee.name"}}),e.errors.employees&&e.errors.employees[a]&&e.errors.employees[a]["name"]?r("Errors",{attrs:{errors:e.errors.employees[a]["name"]}}):e._e()],1)],1),r("div",{staticClass:"col-4 px-0"},[r("b-input-group",{staticClass:"m-b-1"},[r("b-form-input",{staticClass:"mb-2 mr-sm-2 mb-sm-0",attrs:{placeholder:"Enter Title"},model:{value:t.title,callback:function(r){e.$set(t,"title",r)},expression:"annualReviewEmployee.title"}})],1)],1),r("div",{staticClass:"col-4"},[r("b-input-group",{staticClass:"m-b-1"},[r("b-form-input",{staticClass:"mb-2 mr-sm-2 mb-sm-0",attrs:{placeholder:"Enter Department"},model:{value:t.department,callback:function(r){e.$set(t,"department",r)},expression:"annualReviewEmployee.department"}}),r("button",{staticClass:"btn btn__close float-right",on:{click:function(t){return e.deleteEntry(a)}}},[r("b-icon",{staticClass:"remove-employee",attrs:{icon:"x","font-scale":"1"}})],1)],1)],1)])]})),r("b-input-group",[r("b-button",{attrs:{variant:"default"},on:{click:e.addEntry}},[r("b-icon",{staticClass:"mr-2",attrs:{icon:"plus-circle-fill"}}),e._v("New Entry")],1)],1)],2)],1)])]),r("div",{staticClass:"d-flex justify-content-end m-t-20"},[r("button",{staticClass:"btn btn-default m-r-1",on:{click:function(t){return e.saveGeneral()}}},[e._v("Save")]),e.review.complete?r("button",{staticClass:"btn",class:"btn-dark",on:{click:e.markComplete}},[e._v("Mark as Incomplete")]):r("AnnualModalComplite",{attrs:{completedStatus:e.review.complete,name:e.review.name,inline:!1},on:{compliteConfirmed:e.markComplete}},[r("button",{staticClass:"btn",class:"btn-dark"},[e._v("Mark as "+e._s(e.review.complete?"Incomplete":"Complete"))])])],1)])])])]):e._e()]),r("b-tab",{attrs:{title:"Tasks"}},[r("Get",{attrs:{reviewModel:"/api/business/annual_reports/"+e.annualId,etag:e.tasksEtag},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.reviewModel;return[r("PageTasks",{attrs:{review:a},on:{saved:e.newTasksEtag}})]}}])})],1),r("b-tab",{attrs:{title:"Documents"}},[r("PageDocuments")],1)],1)],1)},s=[],i=r("278c"),n=r.n(i),o=r("c973"),l=r.n(o),c=r("9523"),u=r.n(c),v=r("a34a"),d=r.n(v),m=r("2f62"),p=r("66d1"),h=r("80cc"),w=r("5f04"),g=r("2cf0"),_=r("5a64"),b=r("05b9"),f=r("1614"),y=r("f245"),C=r("f774");function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?k(Object(r),!0).forEach((function(t){u()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var x={mixins:[Object(C["a"])("tasksEtag")],props:["annualId"],components:{ReviewsList:h["a"],Tiptap:p["a"],AnnualModalComplite:w["a"],AnnualModalEdit:g["a"],AnnualModalDelete:_["a"],PageTasks:b["a"],PageDocuments:f["a"],PageActivity:y["a"]},data:function(){return{errors:{}}},computed:E(E({},Object(m["c"])({review:"annual/currentReview"})),{},{regulatoryChangesSplit:function(){for(var e=[],t=this.review.regulatory_changes.filter((function(e){return!e["_destroy"]})),r=t.length-1,a=0;a<r;)e.push([t[a],t[a+1]]),a+=2;return e},employees:function(){return this.review.annual_review_employees.filter((function(e){return!e["_destroy"]}))}}),mounted:function(){var e=this;return l()(d.a.mark((function t(){return d.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.getCurrentReviewReview(e.annualId);case 3:t.next=8;break;case 5:t.prev=5,t.t0=t["catch"](0),e.toast("Error",t.t0.message,!0);case 8:case"end":return t.stop()}}),t,null,[[0,5]])})))()},methods:E(E({},Object(m["b"])({updateAnnual:"annual/updateReview",getCurrentReviewReview:"annual/getCurrentReview"})),{},{download_pdf:function(){window.location.href="/business/annual_reports/"+this.annualId+".pdf"},validateRegulatory:function(){for(var e=this.regulatoryChangesSplit.length,t=0;t<=e-1;t++){var r={};this.errors["regulatory"]?(r=this.errors["regulatory"],r[t]={}):r[t]={},this.regulatoryChangesSplit[t][0].change||(r[t][0]=["Required field"]),this.regulatoryChangesSplit[t][1].change||(r[t][1]=["Required field"]),(r[t][0]&&r[t][0].length>0||r[t][1]&&r[t][1].length>0)&&this.$set(this.errors,"regulatory",r)}},validateDateTime:function(){this.review.review_start&&this.review.review_end&&this.review.review_start>this.review.review_end&&this.$set(this.errors,"review_end",["Date must occur after start date"]),this.review.review_start&&!this.review.review_end&&this.$set(this.errors,"review_end",["Start date require End date"]),!this.review.review_start&&this.review.review_end&&this.$set(this.errors,"review_start",["End date require Start date"])},validateEmployee:function(){if(this.review.annual_review_employees.length>0){for(var e=this.review.annual_review_employees,t={},r=0;r<=e.length-1;r++){var a=e[r];a.name||(t[r]={},t[r]["name"]=["Required field"])}Object.keys(t).length>0&&this.$set(this.errors,"employees",t)}},validate:function(){this.errors={},this.validateRegulatory(),this.validateDateTime(),this.validateEmployee()},saveGeneral:function(e){var t=this;return l()(d.a.mark((function r(){var a,s;return d.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.validate(),!(Object.keys(t.errors).length>0)){r.next=3;break}return r.abrupt("return");case 3:return a=t.review,s={id:a.id,review_start:a.review_start,review_end:a.review_end,regulatory_changes_attributes:a.regulatory_changes,material_business_changes:a.material_business_changes,annual_review_employees_attributes:a.annual_review_employees},r.prev=5,r.next=8,t.updateAnnual(s).then((function(r){if(console.log("response",r),r.errors){for(var a=0,s=Object.entries(r.errors);a<s.length;a++){var i=n()(s[a],2),o=i[0],l=i[1];console.log("".concat(o,": ").concat(l)),t.toast("Error","".concat(o,": ").concat(l),!0),t.errors=Object.assign(t.errors,u()({},o,l))}console.log(t.errors)}else r.errors?t.toast("Success","Internal review has not been saved. Please try again."):(t.toast("Success","Internal review has been saved."),e&&setTimeout((function(){return t.$router.push("/business/annual_reviews")}),3e3))}))["catch"]((function(e){return console.error(e)}));case 8:return r.next=10,t.getCurrentReviewReview(t.annualId);case 10:r.next=15;break;case 12:r.prev=12,r.t0=r["catch"](5),t.toast("Error",r.t0.message,!0);case 15:case"end":return r.stop()}}),r,null,[[5,12]])})))()},markComplete:function(){var e=this;return l()(d.a.mark((function t(){var r,a;return d.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.review,a={id:r.id,complete:!e.review.complete},t.prev=2,t.next=5,e.updateAnnual(a).then((function(t){if(t.errors)for(var r=0,a=Object.entries(t.errors);r<a.length;r++){var s=n()(a[r],2),i=s[0],o=s[1];console.log("".concat(i,": ").concat(o)),e.toast("Error","".concat(i,": ").concat(o),!0),e.errors=Object.assign(e.errors,u()({},i,o))}else;}))["catch"]((function(e){return console.error(e)}));case 5:return e.toast("Success","Category has been marked as ".concat(e.review.complete?"in":"","complete.")),t.next=8,e.getCurrentReviewReview(e.annualId);case 8:t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](2),e.toast("Error",t.t0.message,!0);case 13:case"end":return t.stop()}}),t,null,[[2,10]])})))()},addEntry:function(){this.review.annual_review_employees.push({name:"",title:"",department:""})},addRegulatoryChange:function(){this.review.regulatory_changes.push({change:"",timestamp:(new Date).getTime()}),this.review.regulatory_changes.push({change:"",timestamp:(new Date).getTime()+1})},removeRegulatoryChange:function(e,t){var r=e[0],a=e[1];if(r.id&&a.id){r["_destroy"]=!0,a["_destroy"]=!0;var s=this.review.regulatory_changes.findIndex((function(e){return e.id===r.id})),i=this.review.regulatory_changes.findIndex((function(e){return e.id===a.id}));s&&i&&(this.$set(this.review.regulatory_changes,s,r),this.$set(this.review.regulatory_changes,i,a))}else{var n=this.review.regulatory_changes.findIndex((function(e){return e.timestamp===r.timestamp}));n&&this.review.regulatory_changes.splice(n,2)}},duplicateEntry:function(e){this.review.annual_review_employees.push(E({},this.review.annual_review_employees[e+1]))},deleteEntry:function(e){if(this.review.annual_review_employees[e].id){var t=this.review.annual_review_employees[e];t["_destroy"]=!0,this.$set(this.review.annual_review_employees,e,t)}else this.review.annual_review_employees.splice(e,1)},deleteReview:function(e){var t=this;this.$store.dispatch("annual/deleteReview",{id:e}).then((function(e){t.toast("Success","The internal review has been deleted! ".concat(e.id)),t.$router.push("/business/annual_reviews")}))["catch"]((function(e){return t.toast("Error","Something wrong! ".concat(e.message),!0)}))},backToList:function(){this.$router.push({name:"annual-reviews"})}})},R=x,O=(r("615a"),r("2877")),S=Object(O["a"])(R,a,s,!1,null,"21fd655c",null);t["default"]=S.exports},"615a":function(e,t,r){"use strict";r("245c")}}]);
//# sourceMappingURL=chunk-046a2bc6.3a1a6452.js.map
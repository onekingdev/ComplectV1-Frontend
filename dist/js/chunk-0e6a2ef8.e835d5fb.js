(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0e6a2ef8"],{"2c3b":function(t,i,e){},"2d80":function(t,i,e){"use strict";var s=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{class:{"d-inline-block":t.inline}},[e("div",{directives:[{name:"b-modal",rawName:"v-b-modal",value:t.modalId,expression:"modalId"}],class:{"d-inline-block":t.inline}},[t._t("default")],2),e("b-modal",{staticClass:"fade",attrs:{id:t.modalId,title:"Remove Subsections"}},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-1 text-center px-0"},[e("b-icon",{staticClass:"mt-2 ml-3",attrs:{icon:"dash-circle-fill",scale:"2",variant:"danger"}})],1),e("div",{staticClass:"col"},[e("p",{staticClass:"paragraph m-b-10"},[t._v("Removing this subsections will permamently delete any items populated withing it.")]),e("p",{staticClass:"paragraph mb-0"},[e("b",[t._v("Do you want to continue?")])])])]),e("Errors",{attrs:{errors:t.errors.title}}),e("template",{slot:"modal-footer"},[e("button",{staticClass:"btn btn-link",on:{click:function(i){return t.$bvModal.hide(t.modalId)}}},[t._v("Cancel")]),e("button",{staticClass:"btn btn-danger",on:{click:t.submit}},[t._v("Confirm")])])],2)],1)},o=[],n=function(){return Math.random().toFixed(10).toString().replace(".","")},a={props:{flex:{type:Boolean,default:!1},inline:{type:Boolean,default:!0}},data:function(){return{modalId:"modal_".concat(n()),policy:{name:"",description:"N/A",sections:[]},errors:[]}},methods:{submit:function(t){t.preventDefault(),this.errors=[],this.$emit("removeSubsectionConfirmed"),this.$bvModal.hide(this.modalId)}},computed:{},watch:{},components:{}},c=a,l=e("2877"),r=Object(l["a"])(c,s,o,!1,null,null,null);i["a"]=r.exports},4724:function(t,i,e){"use strict";var s=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{class:{"d-inline-block":t.inline}},[e("div",{directives:[{name:"b-modal",rawName:"v-b-modal",value:t.modalId,expression:"modalId"}],class:{"d-inline-block":t.inline}},[t._t("default")],2),e("b-modal",{staticClass:"fade",attrs:{id:t.modalId,title:t.riskId?"Edit risk":"New risk"},on:{close:t.hideModal,show:t.newEtag}},[e("ModelLoader",{attrs:{url:t.riskId?t.submitUrl:void 0,default:t.initialrisk,etag:t.etag},on:{loaded:t.loadrisk}},[t.showRiskOption?e("b-form-group",{staticClass:"form-label mb-3",attrs:{id:"input-group-1",label:"Risk","label-for":"select-1"}},[e("b-form-select",{attrs:{id:"select-1",options:t.options,required:""},on:{change:t.onChange},model:{value:t.risk.risks,callback:function(i){t.$set(t.risk,"risks",i)},expression:"risk.risks"}}),e("Errors",{attrs:{errors:t.errors.risk}})],1):t._e(),e("b-row",{attrs:{"no-gutters":""}},[e("div",{staticClass:"col"},[e("label",{staticClass:"form-label"},[t._v("Risk Name")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.risk.name,expression:"risk.name"}],staticClass:"form-control",domProps:{value:t.risk.name},on:{input:function(i){i.target.composing||t.$set(t.risk,"name",i.target.value)}}}),e("Errors",{attrs:{errors:t.errors.name}})],1)]),e("b-row",{staticClass:"m-t-1",attrs:{"no-gutters":""}},[e("div",{staticClass:"col-sm m-r-1"},[e("b-form-group",{staticClass:"form-label",attrs:{id:"input-group-2",label:"Impact","label-for":"select-2"}},[e("b-form-select",{attrs:{id:"select-2",errors:t.errors.impact,options:t.levelOptions},on:{change:t.onRiskChange},model:{value:t.risk.impact,callback:function(i){t.$set(t.risk,"impact",i)},expression:"risk.impact"}}),e("Errors",{attrs:{errors:t.errors.impact}})],1)],1),e("div",{staticClass:"col-sm"},[e("b-form-group",{staticClass:"form-label",attrs:{id:"input-group-3",label:"Likelihood","label-for":"select-3"}},[e("b-form-select",{attrs:{id:"select-3",errors:t.errors.likelihood,options:t.levelOptions},on:{change:t.onRiskChange},model:{value:t.risk.likelihood,callback:function(i){t.$set(t.risk,"likelihood",i)},expression:"risk.likelihood"}}),e("Errors",{attrs:{errors:t.errors.likelihood}})],1)],1)]),e("b-row",{staticClass:"mt-2",attrs:{"no-gutters":""}},[e("div",{staticClass:"col"},[e("label",{staticClass:"form-label"},[t._v("Risk Level")]),e("div",[e("b-icon",{staticClass:"mr-3",attrs:{icon:"exclamation-triangle-fill",scale:"1",variant:t.badgeVariant}}),t._v(t._s(t.riskLevelName))],1)])])],1),e("template",{slot:"modal-footer"},[e("button",{staticClass:"btn btn-link",on:{click:function(i){return t.hideModal()}}},[t._v("Cancel")]),e("button",{staticClass:"btn btn-dark",on:{click:t.submit}},[t._v(t._s(t.riskId?"Save":"Add"))])])],2)],1)},o=[],n=e("9523"),a=e.n(n),c=e("f774");function l(t,i){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);i&&(s=s.filter((function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),e.push.apply(e,s)}return e}function r(t){for(var i=1;i<arguments.length;i++){var e=null!=arguments[i]?arguments[i]:{};i%2?l(Object(e),!0).forEach((function(i){a()(t,i,e[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):l(Object(e)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}))}return t}var d=function(){return Math.random().toFixed(10).toString().replace(".","")},u=function(){return{name:"",id:null,impact:0,likelihood:0,compliance_policies:[],compliance_policy_ids:[]}},p={mixins:[Object(c["a"])()],props:{id:String,risks:Array,riskId:Number,remindAt:String,inline:{type:Boolean,default:!0},risksList:Array,policyId:Number,showRiskOption:{type:Boolean,default:!1}},data:function(){return{modalId:this.id||"modal_".concat(d()),risk:u(),isActive:!1,options:[{value:null,text:"New Risk"}],levelOptions:[{value:0,text:"Low"},{value:1,text:"Medium"},{value:2,text:"High"}],badgeVariant:"secondary",riskLevelName:"---",errors:{}}},methods:{hideModal:function(){this.errors={},this.$bvModal.hide(this.modalId)},loadrisk:function(t){this.risk=Object.assign({},this.risk,t),this.onRiskChange(),this.options=[{value:null,text:"New Risk"}],this.options=this.options.concat(this.risksComputedAsOptions)},submit:function(t){var i,e=this;(t.preventDefault(),this.errors={},this.risk.name)?(this.risk.compliance_policy_ids=this.risk.compliance_policies.map((function(t){return t.id})),this.risk.compliance_policy_ids.includes(this.policyId)||this.risk.compliance_policy_ids.push(this.policyId),i=this.riskId||this.risk.id?"updateRisk":"createRisk",this.$store.dispatch(i,r({},this.risk)).then((function(t){if(t.errors){var s="createRisk"===i?"Risk has not been created. Please try again.":"Risk has not been updated. Please try again.";e.toast("Error",s)}else"createRisk"==i?e.toast("Success","Risk has been created."):e.toast("Success","Risk has been updated."),e.$emit("saved",t),e.$bvModal.hide(e.modalId),e.newEtag()}))["catch"]((function(t){console.error(t),e.toast("Error","Risk has not been created. Please try again. ".concat(t),!0)}))):this.$set(this.errors,"name",["Required field"])},onChange:function(t){if(null===t)return this.isActive=!0,this.risk=u(),this.badgeVariant="secondary",void(this.riskLevelName="---");this.isActive=!1;var i=this.risks.find((function(i){return i.id===t}));this.risk=i,this.onRiskChange()},onRiskChange:function(){var t=this.riskLevel(this.risk.likelihood,this.risk.impact);this.riskLevelColor(t),this.getRiskLevelName(t)},getRiskLevelName:function(t){this.riskLevelName=this.levelOptions[t].text},riskLevel:function(t,i){return t>0&&2===i?2:t<2&&0===i?0:1},riskLevelColor:function(t){0===t&&(this.badgeVariant="success"),1===t&&(this.badgeVariant="warning"),2===t&&(this.badgeVariant="danger")}},computed:{initialrisk:function(){return u},canBeDraft:function(){return!this.riskId||"draft"===this.risk.status},submitUrl:function(){var t=this.riskId?"/".concat(this.riskId):"";return"/api/business/risks"+t},httpMethod:function(){return this.riskId?"PUT":"POST"},risksComputedAsOptions:function(){return this.risks.map((function(t){return{value:t.id,text:t.name}}))}},watch:{}},h=p,m=e("2877"),v=Object(m["a"])(h,s,o,!1,null,null,null);i["a"]=v.exports},"4ce4":function(t,i,e){"use strict";e.r(i);var s,o=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"policy"},[e("div",{staticClass:"container-fluid"},[e("div",{staticClass:"row"},[t.leftMenu?e("div",{staticClass:"col-12 col-lg-3 px-0"},[e("div",{staticClass:"card-body white-card-body left-tree"},[e("PoliciesModalCreate",{on:{saved:t.updateList}},[e("button",{staticClass:"btn btn-dark mb-3 mr-3"},[t._v("New Policy")])]),e("div",{staticClass:"row"},[e("div",{staticClass:"col-12"},[e("div",{staticClass:"table"},[e("nested-draggable",{attrs:{policiesList:t.policiesListNested,shortTable:!0},model:{value:t.policiesComputed,callback:function(i){t.policiesComputed=i},expression:"policiesComputed"}})],1)])])],1)]):t._e(),t.policy?e("div",{staticClass:"col"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-12 px-0"},[e("div",{staticClass:"card-body white-card-body p-3 px-4"},[e("div",{staticClass:"d-flex justify-content-between"},[e("div",{staticClass:"d-flex align-items-center"},[e("button",{staticClass:"btn btn__menu mr-3",on:{click:function(i){t.leftMenu=!t.leftMenu}}},[e("b-icon",{attrs:{icon:"list"}})],1),e("b-badge",{staticClass:"btn btn-default mr-3",attrs:{variant:"light"}},[t._v("none")]),e("h3",{staticClass:"policy__main-title m-y-0"},[t._v("Entire policies")])],1),e("div",{staticClass:"d-flex justify-content-end align-items-center"},[e("a",{staticClass:"link btn mr-3",on:{click:t.saveDraft}},[t._v("Save Draft")]),e("button",{staticClass:"btn btn-default mr-3",on:{click:t.download}},[t._v("Download")]),e("PoliciesModalPublish",{on:{publishConfirmed:t.publishPolicy}},[e("button",{staticClass:"btn btn-dark mr-3"},[t._v("Publish")])]),e("button",{staticClass:"btn btn__close mr-3",on:{click:t.closeAndExit}},[e("b-icon",{attrs:{icon:"x"}})],1)],1)])])])]),e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 px-0"},[e("b-tabs",{attrs:{"content-class":"mt-0"},scopedSlots:t._u([{key:"tabs-end",fn:function(){return[e("b-dropdown",{staticClass:"ml-auto my-auto mr-5 actions",attrs:{text:"Actions",variant:"default",right:""},scopedSlots:t._u([{key:"button-content",fn:function(){return[t._v("Actions"),e("b-icon",{staticClass:"m-l-1",attrs:{icon:"chevron-down","font-scale":"1"}})]},proxy:!0}],null,!1,3125904501)})]},proxy:!0}],null,!1,1392184241)},[e("b-tab",{attrs:{title:"Details",active:""}},[t.loading?e("div",{staticClass:"row",attrs:{loading:t.loading}},[e("div",{staticClass:"col-12"},[e("div",{staticClass:"card-body white-card-body p-0 position-relative"},[e("div",{staticClass:"policy-details"},[e("div",{staticClass:"policy-details__body"},[e("div",{staticClass:"d-flex flex-column justify-content-center align-items-center mb-2"},[e("b-icon",{attrs:{icon:"three-dots",animation:"cylon","font-scale":"4"}}),e("h5",[t._v("Loading....")])],1)])])])])]):t._e(),t._l(t.policiesList,(function(i){return t.policiesList?e("div",{key:i.id,staticClass:"row m-b-2"},[e("div",{staticClass:"col-12"},[e("div",{staticClass:"card-body white-card-body p-0 position-relative"},[e("div",{staticClass:"policy-details"},[e("div",{staticClass:"policy-details__body"},[e("div",{staticClass:"policy-details-section"},[e("div",{staticClass:"policy-details__name"},[t._v("Name")]),e("div",{staticClass:"d-flex"},[e("input",{directives:[{name:"model",rawName:"v-model",value:i.title,expression:"policy.title"}],staticClass:"policy-details__input",domProps:{value:i.title},on:{input:function(e){e.target.composing||t.$set(i,"title",e.target.value)}}})]),e("div",{staticClass:"policy-details__name"},[t._v("Description")]),t.toggleVueEditor?t._e():e("div",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.left",modifiers:{hover:!0,left:!0}}],staticClass:"policy-details__text-editor",attrs:{title:"Click to edit text"},domProps:{innerHTML:t._s(i.description?i.description:t.description)},on:{click:t.toggleVueEditorHandler}}),t.toggleVueEditor?e("Tiptap",{staticClass:"policy-details__text-editor",on:{blur:t.handleBlur},model:{value:i.description,callback:function(e){t.$set(i,"description",e)},expression:"policy.description"}}):t._e()],1)])]),e("HistoryPolicy",{attrs:{policy:i}})],1)])]):t._e()}))],2)],1)],1)])]):t._e()])])])},n=[],a=e("9523"),c=e.n(a),l=e("a867"),r=e("dd42"),d=e("66d1"),u=e("86b1"),p=e("fead"),h=e("9d25"),m=e("744f"),v=e("67e3"),b=e("4f05"),f=e("2d80"),y=e("d438"),g={components:{nestedDraggable:l["a"],rawdisplayer:r["a"],Tiptap:d["a"],SubsectionPolicy:u["a"],HistoryPolicy:p["a"],PolicyRisks:h["a"],PoliciesModalCreate:m["a"],PoliciesModalDelete:v["a"],PoliciesModalArchive:b["a"],PoliciesModalRemoveSubsection:f["a"],PoliciesModalPublish:y["a"]},data:function(){return{leftMenu:!0,description:"",title:"Section Name",toggleVueEditor:!1,sections:[],count:0,policyId:0}},methods:(s={saveDraft:function(){this.updatePolicy()},download:function(){var t=this;this.$store.dispatch("downloadPolicy",{policyId:this.policyId}).then((function(i){t.toast("Success","Policy has been downloaded.")}))["catch"]((function(i){t.toast("Error",i.message,!0)}))},publishPolicy:function(){var t=this;this.$store.dispatch("publishPolicy",{policyId:this.policyId}).then((function(i){console.log(i),t.toast("Success","Policy has been published."),setTimeout((function(){window.location.href="".concat(window.location.origin,"/business/compliance_policies/").concat(i.id)}),2e3)}))["catch"]((function(i){t.toast("Error",i.message,!0)}))},deletePolicy:function(t){var i=this;console.log("delete ".concat(t)),this.$store.dispatch("deletePolicyById",{policyId:t}).then((function(t){i.toast("Success","Policy has been deleted.")}))["catch"]((function(t){i.toast("Error","Policy has not been deleted. Please try again.",!0)}))},closeAndExit:function(){window.location.href="".concat(window.location.origin,"/business/compliance_policies")},archivePolicy:function(t,i){var e=this;this.$store.dispatch("archivePolicyById",{policyId:this.policyId,archived:i}).then((function(t){console.log("response",t),e.toast("Success","Policy has been ".concat(i?"archived":"unarchived","."))}))["catch"]((function(t){console.error(t),e.toast("Error","Policy has not been ".concat(i?"archived":"unarchived",". Please try again."),!0)}))},deleteAllSections:function(){console.log("delete all"),this.policy.sections=[],this.updatePolicy()},updatePolicy:function(){var t=this,i={id:this.policy.id,name:this.policy.title,description:this.policy.description,sections:this.policy.sections};console.log("updatePolicy dataToSend",i),this.$store.dispatch("updatePolicy",i).then((function(i){t.toast("Success","Policy has been updated."),console.log("response updatePolicy",i)}))["catch"]((function(i){console.log(i),t.toast("Error",i,!0)}))},addSection:function(t){t&&(t.target.closest(".policy-details__btn").style.display="none");var i=Math.floor(100*Math.random());this.policiesComputed={id:i,title:"".concat(this.title),description:this.description,children:[]},console.log("this.policy.sections",this.policy.sections)},deleteSection:function(t){this.policy.sections.splice(t,1),0===this.policy.sections.length&&(document.querySelector(".policy-details__btn").style.display="block")},toggleVueEditorHandler:function(){this.toggleVueEditor=!this.toggleVueEditor},handleBlur:function(){this.toggleVueEditorHandler()},updateList:function(){var t=this;this.$store.dispatch("getPolicies").then((function(i){t.policies=i}))["catch"]((function(i){t.toast("Error",i.message,!0)}))}},c()(s,"deletePolicy",(function(t){var i=this;this.$store.dispatch("deletePolicyById",{policyId:t}).then((function(t){i.toast("Success","Policy has been deleted.")}))["catch"]((function(t){i.toast("Error","Policy has not been deleted. Please try again.",!0)}))})),c()(s,"movePolicy",(function(t){var i=this,e=this.policies[t.oldIndex].position,s=this.policies[t.newIndex].position;this.policies[t.newIndex].position=e,this.policies[t.oldIndex].position=s;var o=[{id:this.policies[t.newIndex].id,position:this.policies[t.newIndex].position},{id:this.policies[t.oldIndex].id,position:this.policies[t.oldIndex].position}];this.$store.dispatch("moveUpPolicy",o).then((function(t){console.log("response",t)}))["catch"]((function(t){i.toast("Error",t.message,!0)}))})),s),computed:{loading:function(){return this.$store.getters.loading},policy:function(){var t=this.policyId;return this.$store.getters.policyById(t)},policiesList:function(){return this.$store.getters.policiesList},policiesComputed:{get:function(){var t,i=this.$store.getters.policiesList,e=i.map((function(i){return t=i["name"],i["title"]=t,t=i["sections"],i["children"]=t,i["sections"]||(i["sections"]=[]),i}));return e},set:function(t){console.log(t),this.$store.dispatch("updatePolicySectionsById",{id:this.policy.id,sections:t})}},policyById:function(){var t=this.policyId;return this.$store.getters.policyById(t)},policiesListNested:function(){return this.$store.getters.policiesListNested}},watch:{policiesComputed:function(t,i){console.log("watch record",t,i)}},mounted:function(){this.updateList()}},k=g,_=(e("b379"),e("2877")),C=Object(_["a"])(k,o,n,!1,null,"23c3d4d0",null);i["default"]=C.exports},"86b1":function(t,i,e){"use strict";var s=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",[e("div",{staticClass:"policy-details-subsection",attrs:{"data-section-id":t.index}},[e("div",{staticClass:"policy-details__name mb-0"},[t._v("Section Name")]),e("div",{staticClass:"d-flex align-items-center"},[t.section.children&&t.section.children.length>0?e("b-icon",{staticClass:"mr-2",attrs:{icon:"chevron-compact-down"}}):e("b-icon",{staticClass:"mr-2",attrs:{icon:"chevron-compact-right"}}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.section.title,expression:"section.title"}],staticClass:"policy-details__input mb-0",domProps:{value:t.section.title},on:{blur:t.handleBlur,input:function(i){i.target.composing||t.$set(t.section,"title",i.target.value)}}}),e("div",{staticClass:"actions"},[0===t.section.children.length?e("button",{staticClass:"policy-details__btn mr-3 btn btn-default",on:{click:t.addSubSection}},[e("b-icon",{staticClass:"mr-2",attrs:{icon:"plus-circle-fill"}}),t._v("Add Subsection")],1):t._e(),e("b-dropdown",{staticClass:"m-0 p-0",attrs:{size:"sm",variant:"light",right:""},scopedSlots:t._u([{key:"button-content",fn:function(){return[e("b-icon",{attrs:{icon:"three-dots"}})]},proxy:!0}])},[e("b-dropdown-item",{on:{click:function(i){return t.moveUpSubsection(t.section)}}},[t._v("Move up")]),e("PoliciesModalRemoveSubsection",{attrs:{inline:!1},on:{removeSubsectionConfirmed:t.deleteSubSection}},[e("b-dropdown-item",{staticClass:"delete"},[t._v("Delete")])],1)],1)],1)],1),e("div",{staticClass:"policy-details__name mb-0"},[t._v("Description")]),t.toggleVueEditor?t._e():e("div",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.left",modifiers:{hover:!0,left:!0}}],staticClass:"policy-details__text-editor",attrs:{title:"Click to edit text"},domProps:{innerHTML:t._s(t.section.description?t.section.description:t.description)},on:{click:t.toggleVueEditorHandler}}),t.toggleVueEditor?e("Tiptap",{staticClass:"policy-details__text-editor",on:{blur:t.handleBlur},model:{value:t.section.description,callback:function(i){t.$set(t.section,"description",i)},expression:"section.description"}}):t._e(),t.section.children&&t.section.children.length>0?e("div",t._l(t.section.children,(function(i,s){return e("PolicySubsection",{key:i.id,attrs:{section:i,index:s,parentSection:t.section,length:t.section.children.length},on:{addSection:t.addSection,deleteSubSection:t.deleteSubSection}})})),1):t._e()],1),t.index+1===t.length?e("button",{staticClass:"policy-details__btn mr-3 btn btn-default",on:{click:t.addSection}},[t._v("Add Section")]):t._e()])},o=[],n=e("66d1"),a=e("2d80"),c={name:"PolicySubsection",props:{length:{type:Number,required:!1},section:{type:Object,required:!0},index:{type:Number,required:!0},parentSection:{required:!1}},components:{Tiptap:n["a"],PoliciesModalRemoveSubsection:a["a"]},data:function(){return{description:"",title:"New Section",toggleVueEditor:!1,isActive:!1,count:0}},computed:{},methods:{deleteSubSection:function(){this.parentSection?this.parentSection.children.splice(this.index,1):this.deleteSection()},deleteSection:function(){this.$emit("deleteSection",this.index)},addSection:function(t){if(this.parentSection){if("undefined"!==typeof this.parentSection.children){t&&(t.target.style.display="none");var i=Math.floor(100*Math.random());this.parentSection.children.push({id:i,title:"".concat(this.title),description:this.description,children:[]})}}else this.$emit("addSection",t)},addSubSection:function(t){t&&(t.target.closest(".policy-details__btn").style.display="none");Math.floor(100*Math.random());this.section.children.push({id:this.count++,title:"".concat(this.title),description:this.description,children:[]})},toggleVueEditorHandler:function(){this.toggleVueEditor=!this.toggleVueEditor},handleBlur:function(t){var i;console.log(t),"INPUT"!==(null===t||void 0===t||null===(i=t.target)||void 0===i?void 0:i.nodeName)&&this.toggleVueEditorHandler(),this.parentSection&&(this.parentSection.children[this.index]={title:this.section.title,description:this.section.description,children:this.section.children},console.log(this.parentSection.children))},moveUpSubsection:function(t){if(console.log("moveUpSubsection"),console.log(t),t){var i=this.parentSection.children.findIndex((function(i){return i.title===t.title})),e=this.parentSection.children[i-1];if(e){this.parentSection.children[i-1]={title:this.section.title,description:this.section.description,children:this.section.children},this.parentSection.children[i]=e;var s=this.parentSection.children;this.parentSection.children=s}}}}},l=c,r=e("2877"),d=Object(r["a"])(l,s,o,!1,null,null,null);i["a"]=d.exports},"9d25":function(t,i,e){"use strict";var s=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"policy-details position-relative"},[e("h3",{staticClass:"policy-details__title"},[t._v("Risks")]),e("div",{staticClass:"policy-actions"},[e("PolicyRisksModal",{attrs:{risks:t.risksComputed,policyId:t.policyId,showRiskOption:!0},on:{saved:t.savedConfirmed}},[t.currentUserBasic||t.policy.archived?t._e():e("button",{staticClass:"btn btn-dark"},[t._v("New Risk")])])],1),e("div",{staticClass:"policy-details__body"},[e("table",{staticClass:"table"},[e("thead",[e("tr",[e("th",{attrs:{width:"56%"}},[t._v("Name"),e("b-icon",{staticClass:"ml-2",attrs:{icon:"chevron-expand"}})],1),e("th",[t._v("Impact"),e("b-icon",{staticClass:"ml-2",attrs:{icon:"chevron-expand"}})],1),e("th",[t._v("Likelihood"),e("b-icon",{staticClass:"ml-2",attrs:{icon:"chevron-expand"}})],1),e("th",[t._v("Risk Level"),e("b-icon",{staticClass:"ml-2",attrs:{icon:"chevron-expand"}})],1),e("th",{staticClass:"text-right"},[t._v("Date Created"),e("b-icon",{staticClass:"ml-2",attrs:{icon:"chevron-expand"}})],1),e("th",{attrs:{width:"35px"}})])]),!t.loading&&t.policyById.risks&&t.policyById.risks.length?e("tbody",{staticClass:"text-dark"},t._l(t.policyById.risks,(function(i){return e("tr",{key:i.id},[e("td",[t._v(t._s(i.name))]),e("td",[t._v(t._s(t.showLevel(i.impact)))]),e("td",[t._v(t._s(t.showLevel(i.likelihood)))]),e("td",[e("b-badge",{staticClass:"badge-risk",attrs:{variant:t.badgeVariant(i.risk_level)}},[e("b-icon-exclamation-triangle-fill",{staticClass:"mr-2"}),t._v(t._s(t.showLevel(i.risk_level)))],1)],1),e("td",{staticClass:"text-right"},[t._v(t._s(t.dateToHuman(i.created_at)))]),e("td",[e("div",{staticClass:"actions"},[e("b-dropdown",{staticClass:"m-0 p-0",attrs:{size:"sm",variant:"light",right:""},scopedSlots:t._u([{key:"button-content",fn:function(){return[e("b-icon",{attrs:{icon:"three-dots"}})]},proxy:!0}],null,!0)},[e("b-dropdown-item-button",{on:{click:function(e){return t.editRisk(i.id)}}},[t._v("Edit")]),e("b-dropdown-item-button",{staticClass:"delete",on:{click:function(e){return t.deleteRisk(i.id)}}},[t._v("Delete")])],1)],1)])])})),0):t._e()]),e("PolicyRisksModal",t._b({attrs:{id:"editRiskModal",risks:t.risksComputed,policyId:t.policyId,inline:!1,showRiskOption:!0},on:{saved:t.updateRisk}},"PolicyRisksModal",t.nowEditingRisk,!1)),e("Loading"),t.loading||!t.policyById.risks||t.policyById.risks.length?t._e():e("EmptyState")],1)])},o=[],n=e("9523"),a=e.n(n),c=e("e829"),l=e("4724"),r=e("f774"),d=e("1315");function u(t,i){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);i&&(s=s.filter((function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),e.push.apply(e,s)}return e}function p(t){for(var i=1;i<arguments.length;i++){var e=null!=arguments[i]?arguments[i]:{};i%2?u(Object(e),!0).forEach((function(i){a()(t,i,e[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):u(Object(e)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}))}return t}var h={mixins:[Object(r["a"])()],props:{policyId:{type:Number,required:!0},currentUserBasic:{type:Boolean,required:!0},policy:{type:Object,required:!0}},components:{Loading:c["a"],PolicyRisksModal:l["a"]},data:function(){return{levelOptions:["Low","Medium","High"],nowEditingRisk:{riskId:null}}},methods:{getRisks:function(t){return console.log("risks",t),t},badgeVariant:function(t){return 0===t?"success":1===t?"warning":2===t?"danger":void 0},showLevel:function(t){return this.levelOptions[t]},dateToHuman:function(t){var i=d["DateTime"].fromJSDate(new Date(t));return i.invalid?i.invalid?t:void 0:i.toFormat("MM/dd/yyyy")},editRisk:function(t){var i=this;Object.assign(this.nowEditingRisk,{riskId:t}),this.$nextTick((function(){return i.$bvModal.show("editRiskModal")}))},updateRisk:function(t){var i=this.policyById.risks.findIndex((function(i){return i.id===t.id}));i>-1&&this.$set(this.policyById.risks,i,t)},deleteRisk:function(t){var i=this,e=this.$store.getters.riskById(t),s=e.compliance_policies.findIndex((function(i){return i.id===t}));e.compliance_policies.splice(s,1),this.policyById.risks.splice(s,1);var o={id:t,compliance_policy_ids:e.compliance_policies.map((function(t){return t.id}))};this.$store.dispatch("updateRisk",p({},o)).then((function(t){i.toast("Success","Risk has been updated.")}))["catch"]((function(t){console.error(t),i.toast("Error","Risk has not been updated. Please try again.",!0)}))},savedConfirmed:function(t){this.policyById.risks.push(t)}},computed:{loading:function(){return this.$store.getters.loading},risksComputed:function(){return this.$store.getters.risksList},policyById:function(){var t=this.policyId;return this.$store.getters.policyById(t)}},mounted:function(){this.$store.dispatch("getRisks").then((function(t){}))["catch"]((function(t){console.error(t)}))}},m=h,v=e("2877"),b=Object(v["a"])(m,s,o,!1,null,null,null);i["a"]=b.exports},b379:function(t,i,e){"use strict";e("2c3b")},d1db:function(t,i,e){t.exports=e.p+"img/error_20.5080af0b.svg"},d438:function(t,i,e){"use strict";var s=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{class:{"d-inline-block":t.inline}},[e("div",{directives:[{name:"b-modal",rawName:"v-b-modal",value:t.modalId,expression:"modalId"}],class:{"d-inline-block":t.inline}},[t._t("default")],2),e("b-modal",{staticClass:"fade",attrs:{id:t.modalId,title:"Publish Policy"}},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-1 text-center px-0"},[e("b-icon",{staticClass:"mt-1 ml-3",attrs:{icon:"check-circle-fill",width:"25",height:"25",variant:"success"}})],1),e("div",{staticClass:"col"},[e("p",{staticClass:"paragraph m-b-10"},[t._v("You are publishing a policy which will make it viewable to all users. It will also be included in an official version of the compliance manual.")]),e("p",{staticClass:"paragraph mb-0"},[e("b",[t._v("Do you want to continue?")])])])]),e("Errors",{attrs:{errors:t.errors.title}}),e("template",{slot:"modal-footer"},[e("button",{staticClass:"btn btn-link",on:{click:function(i){return t.$bvModal.hide(t.modalId)}}},[t._v("Cancel")]),e("button",{staticClass:"btn btn-dark",on:{click:t.submit}},[t._v("Confirm")])])],2)],1)},o=[],n=function(){return Math.random().toFixed(10).toString().replace(".","")},a={props:{inline:{type:Boolean,default:!0}},data:function(){return{modalId:"modal_".concat(n()),errors:[]}},methods:{submit:function(t){t.preventDefault(),this.errors=[],this.$emit("publishConfirmed"),this.$bvModal.hide(this.modalId)}}},c=a,l=e("2877"),r=Object(l["a"])(c,s,o,!1,null,null,null);i["a"]=r.exports},f774:function(t,i,e){"use strict";var s=e("9523"),o=e.n(s),n=function(){return Math.random()},a=function(t){var i=t||"etag",e="new"+i[0].toUpperCase()+i.substring(1);return{data:function(){return o()({},i,n())},methods:o()({},e,(function(){this[i]=n()}))}};i["a"]=a},fead:function(t,i,e){"use strict";var s=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"policy-details position-relative"},[e("h3",{staticClass:"policy-details__title"},[t._v("Version History")]),e("div",{staticClass:"p-x-20"},[t._l(t.policy.versions,(function(i,s){return t.policy.versions&&0!==t.policy.versions.length?e("div",{staticClass:"policy-history__body",class:[t.policy.versions.length>1?"mb-2":""]},[e("div",{staticClass:"policy-history__version-info"},[t._v(t._s("Version "+(t.policy.versions.length-s)))]),e("div",{staticClass:"policy-history__author"},[t._v("Published by "+t._s(i.published_by))]),e("div",{staticClass:"policy-history__date"},[t._v("Last updated "+t._s(t.dateToHuman(i.updated_at)))]),e("b-button",{staticClass:"btn policy-history__btn-download",on:{click:function(i){return t.download(t.policy.id)}}},[t._v("Download")])],1):t._e()})),t.policy.versions&&0===t.policy.versions.length?e("div",{staticClass:"policy-details__body"},[e("EmptyState")],1):t._e()],2)])},o=[],n=e("1315"),a={props:["policy"],data:function(){return{}},computed:{userName:function(){var t=localStorage.getItem("app.currentUser"),i=JSON.parse(t);if(i){var e=i.contact_first_name?"".concat(i.contact_first_name," ").concat(i.contact_last_name):"".concat(i.first_name," ").concat(i.last_name);return"undefined undefined"!==e?e:""}return""}},methods:{dateToHuman:function(t){var i=n["DateTime"].fromJSDate(new Date(t));return i.invalid?i.invalid?t:void 0:i.toFormat("MM/dd/yyyy")},download:function(t){var i=this;this.$store.dispatch("downloadPolicy",{policyId:t}).then((function(t){i.toast("Success","Policy has been queued for download.")}))["catch"]((function(t){i.toast("Error","Policy has not been queued for download. Please try again. "+t.message,!0)}))}}},c=a,l=e("2877"),r=Object(l["a"])(c,s,o,!1,null,null,null);i["a"]=r.exports}}]);
//# sourceMappingURL=chunk-0e6a2ef8.e835d5fb.js.map